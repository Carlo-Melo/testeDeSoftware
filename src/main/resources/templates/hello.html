<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de Veículos</title>
</head>
<script>
    function salvarVeiculo() {
        const veiculo = {
            descricao: document.getElementById('cadDescricao').value,
            fabricante: document.getElementById('cadFabricante').value,
            cor: document.getElementById('cadCor').value,
            placa: document.getElementById('cadPlaca').value
        };

        if (!veiculo.descricao || !veiculo.fabricante || !veiculo.cor || !veiculo.placa) {
            alert('Preencha todos os campos!');
            return;
        }

        fetch('/veiculos', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(veiculo)
        })
        .then(response => response.json())
        .then(data => {
            alert('Veículo cadastrado com sucesso!');
            document.getElementById('modalCadastro').style.display = 'none';
            location.reload();
        })
        .catch(error => alert('Erro ao cadastrar veículo'));
    }

    function editarVeiculo() {
        const id = document.getElementById('editId').value;
        const veiculo = {
            descricao: document.getElementById('editDescricao').value,
            fabricante: document.getElementById('editFabricante').value,
            cor: document.getElementById('editCor').value,
            placa: document.getElementById('editPlaca').value
        };

        if (!veiculo.descricao || !veiculo.fabricante || !veiculo.cor || !veiculo.placa) {
            alert('Preencha todos os campos!');
            return;
        }

        fetch('/veiculos/' + id, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(veiculo)
        })
        .then(response => response.json())
        .then(data => {
            alert('Veículo atualizado com sucesso!');
            document.getElementById('modalEditar').style.display = 'none';
            location.reload();
        })
        .catch(error => alert('Erro ao atualizar veículo'));
    }

    function deletar(btn) {
        if (!confirm('Deseja deletar?')) {
            return;
        }
        let id = btn.dataset.id;
        fetch('/veiculos/'+id, {
            method: 'DELETE',
        })
        .then(data => {
            alert('veiculo deletado com sucesso')
            location.reload()
        })
        .catch(error => alert('erro ao deletar veiculo'));
    }

    function abrirModalEditar(id, descricao, fabricante, cor, placa) {
        document.getElementById('editId').value = id;
        document.getElementById('editDescricao').value = descricao;
        document.getElementById('editFabricante').value = fabricante;
        document.getElementById('editCor').value = cor;
        document.getElementById('editPlaca').value = placa;
        document.getElementById('modalEditar').style.display = 'block';
    }

    function abrirModalEditarDados(btn) {
        const id = btn.dataset.id;
        const descricao = btn.dataset.descricao;
        const fabricante = btn.dataset.fabricante;
        const cor = btn.dataset.cor;
        const placa = btn.dataset.placa;
        abrirModalEditar(id, descricao, fabricante, cor, placa);
    }
</script>
<body>
    <h1>Gerenciamento de Veículos</h1>
    <button onclick="document.getElementById('modalCadastro').style.display='block'">Cadastrar Veículo</button>
    <button onclick="location.reload()">Recarregar Lista</button>

    <table border="1" style="width:100%; margin-top:20px; border-collapse:collapse;">
        <thead>
            <tr>
                <th style="padding:10px;">Descrição</th>
                <th style="padding:10px;">Fabricante</th>
                <th style="padding:10px;">Cor</th>
                <th style="padding:10px;">Placa</th>
                <th style="padding:10px;">Ações</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="veiculo : ${veiculos}">
                <td style="padding:10px;" th:text="${veiculo.descricao}"></td>
                <td style="padding:10px;" th:text="${veiculo.fabricante}"></td>
                <td style="padding:10px;" th:text="${veiculo.cor}"></td>
                <td style="padding:10px;" th:text="${veiculo.placa}"></td>
                <td style="padding:10px;">
                    <button class="btn-editar"
                            onclick="abrirModalEditarDados(this)"
                            th:data-id="${veiculo.id}"
                            th:data-descricao="${veiculo.descricao}"
                            th:data-fabricante="${veiculo.fabricante}"
                            th:data-cor="${veiculo.cor}"
                            th:data-placa="${veiculo.placa}">Editar</button>
                    <button onclick="deletar(this)" class="btn-deletar" th:data-id="${veiculo.id}">Deletar</button>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Modal Cadastro -->
    <div id="modalCadastro" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
        <div style="background:white; margin:100px auto; padding:25px; width:400px;">
            <h2>Cadastrar Veículo</h2>
            <label>Descrição:</label><br>
            <input type="text" id="cadDescricao" style="width:100%; padding:8px; margin-bottom:10px;"><br>
            <label>Fabricante:</label><br>
            <input type="text" id="cadFabricante" style="width:100%; padding:8px; margin-bottom:10px;"><br>
            <label>Cor:</label><br>
            <input type="text" id="cadCor" style="width:100%; padding:8px; margin-bottom:10px;"><br>
            <label>Placa:</label><br>
            <input type="text" id="cadPlaca" style="width:100%; padding:8px; margin-bottom:10px;"><br>
            <button onclick="salvarVeiculo()">Salvar</button>
            <button onclick="document.getElementById('modalCadastro').style.display='none'">Cancelar</button>
        </div>
    </div>

    <!-- Modal Editar -->
    <div id="modalEditar" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
        <div style="background:white; margin:100px auto; padding:20px; width:400px;">
            <h2>Editar Veículo</h2>
            <input type="hidden" id="editId">
            <label>Descrição:</label><br>
            <input type="text" id="editDescricao" style="width:100%; padding:8px; margin-bottom:10px;"><br>
            <label>Fabricante:</label><br>
            <input type="text" id="editFabricante" style="width:100%; padding:8px; margin-bottom:10px;"><br>
            <label>Cor:</label><br>
            <input type="text" id="editCor" style="width:100%; padding:8px; margin-bottom:10px;"><br>
            <label>Placa:</label><br>
            <input type="text" id="editPlaca" style="width:100%; padding:8px; margin-bottom:10px;"><br>
            <button onclick="editarVeiculo()">Salvar</button>
            <button onclick="document.getElementById('modalEditar').style.display='none'">Cancelar</button>
        </div>
    </div>
</body>
</html>